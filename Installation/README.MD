# VO-SemRep Installation

Below are instructions on how to install SemRep and integrate [Vaccine Ontology (VO)](https://ontobee.org/ontology/VO) into SemRep.

- Prepared by: Nor Danish Imran
- Helped by Oliver He, Jie Zheng. 

## Outline:
- General SemRep installation. 
- VO customization for SemRep. 
   - Introduce Background with EFO customization (https://lhncbc.nlm.nih.gov/ii/tools/MetaMap/additional-tools/DataFileBuilder.html), and why/how it does not work for VO.  
   - How to prepare VO-related files for SemRep to use. 
   - How to use these files.
   - Possible bugs and how to solve them. 

## General SemRep installation:
The general steps of installing SemRep can be found in the SemRep repo [here](https://github.com/lhncbc/SemRep). The SemRep linked provide installation steps for 2006AA and 2018AA of UMLS release. If you wish to use newer release of UMLS, navigate below.

### Using SemRep with updated UMLS Metathesaurus:
Because SemRep hasn't been updated in a while, we need to do some workaround for SemRep to work with newer version of UMLS Metathesaurus. 
   1. Make sure you have installed the UMLS release you wanted to use it with.  
   2. Navigate to <SemRep dir>/DATA/UMLS_HIERARCHY folder, and make a copy of each hierarchy file from 2006AA and 2018AA. Then for each copy, rename it to the {YEAR}{VERSION} of your chosen UMLS release, as shown below.   
```
hrel-UMLS_btree.2006AA_1
hrel-UMLS_btree.2006AA_2
...
hrel-UMLS_btree.2006AA_5
hrel-UMLS_btree.2018AA_1

// example: 2022AB
// rename the files to

hrel-UMLS_btree.2022AB_1
hrel-UMLS_btree.2022AB_2
...
hrel-UMLS_btree.2022AB_5
hrel-UMLS_btree.2022AB_6

// You should have 6 new hierarchy files.
```
   3. Add {YEAR} to "AVAILABLE DATA" variable in <SemRep dir>/bin/install.sh file.
   4. Follow general steps of installation from SemRep repo. 

## VO customization for SemRep. 

### Introduce Background with EFO customization
Generating a custom database for UMLS/SemRep use is made possible by Data File Builder. Navigate to this [link](https://lhncbc.nlm.nih.gov/ii/tools/MetaMap/additional-tools/DataFileBuilder.html) to explore the Data File Builder README and the given example using Experimental Factor Ontology (EFO). Though the way the example is demonstrated is for MetaMap use and not SemRep. So, there are a few workarounds to make it work with SemRep.

[!NOTE]
The EFO instruction was prepared a long time ago, and the file provided (efo2dfb.zip) on the page is made a decade ago. 
SemRep won't work without setting the semantic types of concepts properly. The given example sets every concept's semantic type to unknown and this works with MetaMap but not SemRep.

### Preparation and Usage of VO-related files for SemRep to use. 

1. Download the VO OWL file from [Ontobee](https://ontobee.org/ontology/VO).
2. Place the OWL file into the vo2dfb directory and run the vo_extract file using the code below.
```
// Usage: ./python vo_extract.py {VO_OWL_filename}
./python vo_extract.py  VO_merged.owl
```
3. Follow the directions provided in the [Data File Builder README.](https://lhncbc.nlm.nih.gov/ii/tools/MetaMap/Docs/datafilebuilder.pdf). The files generated should be pasted in /<db>/umls folder.

[!IMPORTANT]
Semantic type assignment in vo_extract.py is inaccurate as it only assigns semantic type based on the source ontology. More accurate assignment is required and will be addressed/updated soon as it is a work in progress.

### Possible bugs and how to solve them. 

**Problem 1:** MetaMap or SemRep not producing output using custom database.
   1. Check that MRSTY.RRF file in /<db>/01metawordindex/Filter folder is not empty.
   2. If it is empty, delete it and paste the same MRSTY.RRF file from /<db>/umls or the one generated by vo_extract.py.

 **Problem 2:** get_semtype or SemRep wrapper error.
   1. Make sure to not assign semantic types that aren't recognizable by SemRep. Lists of semantic types is listed [here](https://lhncbc.nlm.nih.gov/ii/tools/MetaMap/Docs/SemanticTypes_2018AB.txt).
